Server: //172.16.28.21
Web service: http://ws.talma.aero:8084/Code/Manifiesto.svc

Metodo: public int EnviarArchivoACMA(string usuario, string clave, string tipoTransaccion, byte[] buffer)



Jenny de TCI


Obtener la DUA con el numero de GUIA

Hacer la consulta del levante aduanero

-----------------------------------------------------


1:OBTENEMOS LA CANTIDAD DE GUIAS DEL MANIFIESTO (EJM: 11)
SELECT * FROM TLMIMPO.TDMANI_IMPO WHERE NU_MANI = '201800000008880' AND TI_GUIA = 'D' AND ST_GUIA != 'ANU'
2:UNION DE ESTAS DOS TABLAS 
EDIT TLMTRADU.ADU_TBARCH_GUIA where NU_MANI = '201800000008880'
EDIT TLMIMPO.TDMANI_ENVI where NU_MANI = '201800000008880'
3:INNER JOIN DEL PASO 2 CON LA TABLA RESPUESTA DE ARCHIVOS QUE NO HAYAN TENIDO ERRORES POR EL NUMERO DE ORDEN
EDIT TT_RESPUESTA_ADUANA WHERE ANIO = '2018' AND NUMORDEN = '130978'
4:SI LA CANTIDAD DE REGISTROS DEL PUNTO 3 ES MAYOR O IGUAL A LA CANTIDAD DEL PUNTO 1 ENTONCES SE REALIZO BIEN TODO EL ANEXO 5 DEL VUELO 

--------------------------------

EDIT TT_MANIFIESTOPROVISIONAL
SELECT * FROM TC_VUELO 
WHERE IMPORT_EXPORT = 'IM' 
AND COD_AEROLINEA = IN_COD_AEROLINEA 
AND NUM_VUELO = IN_NUM_VUELO
AND FEC_VUELO = TO_CHAR(IN_FEC_VUELO, 'DD/MM/YYYY') 
        
SELECT COUNT(*) vTIENE_ANEXO6 FROM TLMIMPO.TDMANI_IMPO
WHERE CO_EMPR = '02' 
AND CO_TERM = '3507' 
AND TI_GUIA = 'D'
AND ST_GUIA <> 'ANU'
AND NU_MANI = '201800000008880'
AND (NU_BULT_MANI != NU_BULT_RECI OR NU_BULT_MALO > 0 OR  NU_BULT_RECI =  0)

 - bult mani <> bult reci
 - bult mal estado > 0
 - falto total de la guia (bult_rec = 0)

 bulto_rec > 0, si bult_rec = 0 (no hay tarja por lo que no hay anexo 5)

SELECT V.FEC_VUELO, V.COD_AEROLINEA, V.NUM_VUELO, V.IMPORT_EXPORT, 
                      MI.NU_MANI, MI.NU_GUIA_MADR
                 FROM TLMIMPO.TDMANI_IMPO MI INNER JOIN TC_VUELO V
                   ON V.NUM_MANIFIESTO = MI.NU_MANI
                WHERE MI.CO_EMPR = '02' AND MI.CO_TERM = '3507' AND MI.TI_GUIA = 'D'
                  AND mi.st_guia <> 'ANU'
                  AND (5 = 6 and (MI.NU_BULT_MALO > 0 OR MI.NU_BULT_MANI <> MI.NU_BULT_RECI ) or
                       (5 = 5))
                  AND V.FE_CREA BETWEEN TRUNC(SYSDATE) AND TRUNC(SYSDATE+1)
AND NU_MANI = '201800000008880'
11 GUIAS
                  
SELECT FEC_VUELO, COD_AEROLINEA, NUM_VUELO, IMPORT_EXPORT,
                      NU_MANI, count(NU_MANI) CANTGUIAS 
                 FROM MANIFIESTOS_VUELOS_DIA
                GROUP BY FEC_VUELO, COD_AEROLINEA, NUM_VUELO, IMPORT_EXPORT, NU_MANI
                
11 GUIAS
ENVIOS_SITRADE
SELECT SND.NU_MANI FROM 
(SELECT T1.NU_ORDEN, T1.NU_MANI, T1.NU_GUIA_MADR, T1.CO_ARCH NO_ARCH, T1.CO_USUA_CREA, T1.FE_USUA_CREA
                 FROM TLMTRADU.ADU_TBARCH_GUIA T1 INNER JOIN TLMTRADU.TTTIPO_TRANS T3
                   ON T1.CO_TITRANS = T3.CO_TITRANS AND T3.CO_EMPR = T1.CO_EMPR
                WHERE T1.CO_EMPR = '02' AND T1.TI_NEGOCIO = 'IMP' AND T1.FE_USUA_CREA > SYSDATE - 1
                  AND T1.CO_TITRANS IN (select * from table(FN_SPLIT(8, 3)))
                UNION ALL
               SELECT NU_ORDE, NU_MANI, NU_GUIA_MADR, NO_ARCH, CO_USUA_MODI CO_USUA_CREA, FE_USUA_MODI FE_USUA_CREA
                 FROM TLMIMPO.TDMANI_ENVI
                WHERE CO_EMPR = '02' AND CO_TERM = '3507' AND TI_ENTI = 'LIN' AND TP_OPER = '4'                   
                  AND FE_USUA_MODI > SYSDATE - 1 AND TP_ENVI = 2
                  AND NU_MANI = '201800000008880') SND
INNER JOIN TT_RESPUESTA_ADUANA RESP ON SND.NU_ORDEN = RESP.NUMORDEN 
WHERE RESP.CODERROR IS NULL
                  AND RESP.FE_CREA BETWEEN TRUNC(SYSDATE) AND TRUNC(SYSDATE+1)
                GROUP BY SND.NU_MANI
                
SELECT SND.NU_MANI, COUNT(SND.NU_MANI) TOTAL_ACEPT-- SND.NU_GUIA_MADR, SND.NU_ORDEN, RESP.CODERROR
                 FROM ENVIOS_SITRADE SND INNER JOIN TT_RESPUESTA_ADUANA RESP 
                   ON SND.NU_ORDEN = RESP.NUMORDEN
                WHERE RESP.CODERROR IS NULL
                  AND RESP.FE_CREA BETWEEN TRUNC(SYSDATE) AND TRUNC(SYSDATE+1)
                GROUP BY SND.NU_MANI



-------------------------
TT_PASO_PROCESO_VUELO

SELECT TLMTRADU.FN_COLOR_PROCES(SYSDATE, 'XL', '1450', 2) from dual
SELECT TLMTRADU.FN_COLOR_PROCES(SYSDATE, 'XL', '1450', 5) from dual


EDIT TT_MANIFIESTOPROVISIONAL WHERE FECHASALIDALLEGADA = '23/03/2018' and AEROLINEA = 'LP' AND VUELO = '2477'
EDIT TC_VUELO WHERE TO_CHAR(FEC_VUELO, 'DD/MM/YYYY')  = '23/03/2018' AND IMPORT_EXPORT = 'IM' AND NUM_VUELO = '2477'

ESTADO:
------ 
PENDIENTE
CERRADO

ESTADO      TIPO        USUARIO     MOTIVO CIERRE
FINALIZADO  MANUAL      LAN         SE CERRO DEBIDO A QUE SE REALIZARÁ LA TRANSMISION POR EXPEDIENTE 
FINALIZADO  AUTOMATICO  PROCESO     PROCESO



select * from TLMIMPO.TMREGISTROS_ACMA   where
substr(GUFECHAVUELO, 10) = '2018-03-22'
 
GUCODAEROLINEALET = 'LA' and GUIMPORTEXPORT = 'I' and GUNUMVUELO = '0601'
--nd GUNUMGUIA = '004503307581'
and substr(GUFECHAVUELO, 10) = '2018-03-22'

EDIT TT_MANIFIESTOPROVISIONAL
